name: vkquake
modules:
  - name: spirv-tools
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://api.github.com/repos/KhronosGroup/SPIRV-Tools/zipball/vulkan-sdk-1.3.296.0
        sha256: e185f6f5de99bf426487e12ed705d6a6ef87f1a780457bb8e2a43e14ef13f8a0
        dest-filename: spirv-tools.zip
        x-checker-data:
          type: json
          url: https://api.github.com/repos/KhronosGroup/SPIRV-Tools/releases/latest
          version-query: .tag_name | sub("vulkan-sdk-"; "")
          url-query: .zipball_url
      - type: archive
        url: https://api.github.com/repos/KhronosGroup/SPIRV-Headers/zipball/vulkan-sdk-1.3.296.0
        sha256: 35504076dbd25a7d82d37183f13d668c6f16f2e036798f2ebc906da4f68d0037
        dest-filename: spirv-headers.zip
        dest: external/spirv-headers
        x-checker-data:
          type: json
          url: https://api.github.com/repos/KhronosGroup/SPIRV-Headers/releases/latest
          version-query: .tag_name | sub("vulkan-sdk-"; "")
          url-query: .zipball_url
sources:
  - type: archive
    url: https://api.github.com/repos/novum/vkquake/zipball/1.31.3
    sha256: d4069c6fe9c0385cf214f82e25bac9a2f309bd7d2fa6e5f34024bd8014a9b1c9
    dest-filename: vkquake.zip
    x-checker-data:
      type: json
      url: https://api.github.com/repos/novum/vkquake/releases/latest
      version-query: .tag_name
      url-query: .zipball_url
  - type: patch
    path: io.github.novum.vkquake.userdir_log.patch
  - type: file
    path: io.github.sezero.quakespasm.png
buildsystem: meson
config-opts:
  - -Ddo_userdirs=enabled
post-install:
  - install -D -m755 -t /app/bin/ vkquake
  - install -D -m644 -t /app/bin/ ../Quake/vkquake.pak
  - install -Dm644 ../io.github.sezero.quakespasm.png /app/share/icons/hicolor/256x256/apps/io.github.lavenderdotpet.LibreQuake.quakespasm.png
